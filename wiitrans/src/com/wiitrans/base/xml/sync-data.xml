<sync-datas>
	<sync-data name="insertUser">
		<targets>
			<target>
				INSERT INTO `node_user`
                (
                    `user_id`,`node_id`,`email`,`role_id`,`nickname`,`head`,`internal`,`time_zone_id`,
                    `level_id`,`experience`,
                    `money`,`aggregate_money`,
                    `money_usd`,`aggregate_money_usd`,
                    `money_eur`,`aggregate_money_eur`,
                    `word_count`,`normal_order_number`,`total_order_number`
                )
                VALUES
                (
                    '${user_id}','${node_id}','${email}','${role_id}','${nickname}','${head}',${internal},${time_zone_id},
                    '${level_id}','${experience}',
                    '${money}','${aggregate_money}',
                    '${money_usd}','${aggregate_money_usd}',
                    '${money_eur}','${aggregate_money_eur}',
                    '${word_count}','${normal_order_number}','${total_order_number}'
                );

			</target>
			
		</targets>
		<source>
			SELECT `user_id`,`email`,`role_id`,`nickname`,`head`,`internal`,`time_zone_id`,#{nid} as 'node_id'
				,td.level_id,td.experience
				,td.money,td.aggregate_money
				,td.money_usd,td.aggregate_money_usd
				,td.money_eur,td.aggregate_money_eur
				,td.word_count,td.normal_order_number,td.total_order_number
			FROM user u
			INNER JOIN translator_details td ON u.user_id = td.translator_id
			AND u.user_id= '#{uid}' AND u.role_id = 2
			UNION
			SELECT `user_id`,`email`,`role_id`,`nickname`,`head`,`internal`,`time_zone_id`,#{nid} as 'node_id'
				,0,0
				,cd.money,cd.aggregate_money
				,cd.money_usd,cd.aggregate_money_usd
				,cd.money_eur,cd.aggregate_money_eur
				,cd.word_count,0,cd.order_number total_order_number
			FROM user u
			INNER JOIN customer_details cd ON u.user_id = cd.customer_id
			AND u.user_id= '#{uid}' AND u.role_id != 2;
		</source>
	</sync-data>
	
	
	
	<sync-data name="updateUser" >
	    <targets>
		    <target>
			    UPDATE `node_user`
                SET `head` = '${head}'
                	,`role_id` = ${role_id}
                	,`internal` = ${internal}
	                ,`level_id` = '${level_id}'
	                ,`time_zone_id` = ${time_zone_id}
	                ,`experience` = '${experience}'
	                ,`money` = '${money}'
	                ,`aggregate_money` = '${aggregate_money}'
	                ,`money_usd` = '${money_usd}'
	                ,`aggregate_money_usd` = '${aggregate_money_usd}'
	                ,`money_eur` = '${money_eur}'
	                ,`aggregate_money_eur` = '${aggregate_money_eur}'
	                ,`word_count` = '${word_count}'
	                ,`normal_order_number` = '${normal_order_number}'
	                ,`total_order_number` = '${total_order_number}'
                WHERE `user_id` = '${user_id}';
		    </target>
	    </targets>
	    <source>
			SELECT `user_id`,`role_id`,`head`,`internal`,`time_zone_id`
				,td.level_id,td.experience
				,td.money,td.aggregate_money
				,td.money_usd,td.aggregate_money_usd
				,td.money_eur,td.aggregate_money_eur
				,td.word_count,td.normal_order_number,td.total_order_number
			FROM user u
			INNER JOIN translator_details td ON u.user_id = td.translator_id
			AND u.user_id= '#{uid}' AND u.role_id = 2
			UNION
			SELECT `user_id`,`role_id`,`head`,`internal`,`time_zone_id`
				,0,0
				,cd.money,cd.aggregate_money
				,cd.money_usd,cd.aggregate_money_usd
				,cd.money_eur,cd.aggregate_money_eur
				,cd.word_count,0,cd.order_number total_order_number
			FROM user u
			INNER JOIN customer_details cd ON u.user_id = cd.customer_id
			AND u.user_id= '#{uid}' AND u.role_id != 2;
	    </source>
	</sync-data>
	
	<sync-data name="insertOrder" >
		<targets>
			<target>
				INSERT INTO `node_order`
					(`order_id`,`node_id`,`pair_id`,`industry_id`,
					`translator_id`,`editor_id`,`customer_id`,`price_level_id`,`code`,
					`status`,`expedite`,`word_count`,`analyse_word_count`,`valid_word_count_t`,`valid_word_count_e`,
					`currency_id`,`total_money`,`analyse_total_money`,`expected_money_t`,	
					`expected_money_e`,	`actual_money_t`,`actual_money_e`,
					`create_time`,`expected_delivery_time`,`expected_delivery_time_t`,`expected_delivery_time_e`,
					`actual_delivery_time`,`actual_delivery_time_t`,`actual_delivery_time_e`,
					`get_time_t`,`get_time_e`,`confirmation_time`,
					`payment_time`,`receipt_time`,`close_time`,
					`invoice`,`edit_score`,`special`,`offline`,`payment_type`,`offline_payment_status`,`tm_id`,`match_type`,`term_group_id`)
				VALUES(
					'${order_id}','${node_id}','${pair_id}','${industry_id}',
					'${translator_id}','${editor_id}','${customer_id}','${price_level_id}','${code}',
					'${status}',${expedite},'${word_count}',${analyse_word_count},'${valid_word_count_t}','${valid_word_count_e}',
					'${currency_id}','${total_money}','${analyse_total_money}','${expected_money_t}',	
					'${expected_money_e}','${actual_money_t}','${actual_money_e}',
					'${create_time}','${expected_delivery_time}','${expected_delivery_time_t}','${expected_delivery_time_e}',
					'${actual_delivery_time}','${actual_delivery_time_t}','${actual_delivery_time_e}',
					'${get_time_t}','${get_time_e}','${confirmation_time}',
					'${payment_time}','${receipt_time}','${close_time}',
					'${invoice}','${edit_score}','${special}',${offline},'${payment_type}',${offline_payment_status},'${tm_id}','${match_type}','${term_group_id}'
				);
			</target>
			<target>
				INSERT INTO `node_order_description` (order_id,node_id,description) 
				VALUES('${order_id}','${node_id}','${description}');
			</target>
			<target>
				DELETE FROM `node_order_cat` WHERE order_id = '${order_id}' AND node_id = '${node_id}';
			</target>
			<target>
				INSERT INTO `node_order_cat`(order_id,node_id,cat_id)
				SELECT '${order_id}','${node_id}',cat_id 
				FROM `dict_cat` WHERE find_in_set(cat_id,'${cat_ids}');
			</target>

		</targets>
		<source>
			SELECT o.`order_id`,#{nid} as 'node_id',`pair_id`,o.`industry_id`,
					`translator_id`,`editor_id`,`customer_id`,`price_level_id`,`code`,
					`status`,`expedite`,`word_count`,`analyse_word_count`,`valid_word_count_t`,`valid_word_count_e`,
					`currency_id`,`total_money`,`analyse_total_money`,`expected_money_t`,	
					`expected_money_e`,	`actual_money_t`,`actual_money_e`,
					`create_time`,`expected_delivery_time`,`expected_delivery_time_t`,`expected_delivery_time_e`,
					`actual_delivery_time`,`actual_delivery_time_t`,`actual_delivery_time_e`,
					`get_time_t`,`get_time_e`,`confirmation_time`,
					`payment_time`,`receipt_time`,`close_time`,
					`invoice`,`edit_score`,`special`,`offline`,`payment_type`,`offline_payment_status`,`tm_id`,`match_type`,`term_group_id`,
					od.description,(SELECT GROUP_CONCAT(cat_id) FROM `order_cat` WHERE order_id = o.order_id) cat_ids
			FROM `order` o 
			INNER JOIN `dict_industry` di ON o.industry_id = di.industry_id AND o.order_id = '#{order_id}'
			LEFT JOIN `order_description` od ON o.order_id = od.order_id;

		</source>
	</sync-data>
	<sync-data name="updateOrder" >
		<targets>
			<target>
				UPDATE `node_order`
				SET
					`translator_id` = '${translator_id}',
					`editor_id` = '${editor_id}',
					`status` = '${status}',
					`valid_word_count_t` = '${valid_word_count_t}',
					`valid_word_count_e` = '${valid_word_count_e}',
					`actual_money_t` = '${actual_money_t}',
					`actual_money_e` = '${actual_money_e}',
					`actual_delivery_time` = '${actual_delivery_time}',
					`actual_delivery_time_t` = '${actual_delivery_time_t}',
					`actual_delivery_time_e` = '${actual_delivery_time_e}',
					`get_time_t` = '${get_time_t}',
					`get_time_e` = '${get_time_e}',
					`confirmation_time` = '${confirmation_time}',
					`payment_time` = '${payment_time}',
					`receipt_time` = '${receipt_time}',
					`close_time` = '${close_time}',
					`invoice` = '${invoice}',
					`edit_score` = '${edit_score}',
					`special` = '${special}',
					`offline` = ${offline},
					`offline_payment_status` = ${offline_payment_status},
					`tm_id` = '${tm_id}',
					`match_type`= '${match_type}',
					`term_group_id` = '${term_group_id}'
					WHERE `order_id` = '${order_id}';
			</target>
			<target>
				UPDATE `node_order_description`
				SET description = '${description}'
				WHERE `order_id` = '${order_id}';
			</target>
		</targets>
		<source>
			SELECT o.`order_id`,`translator_id`,`editor_id`,
					`status`,`valid_word_count_t`,`valid_word_count_e`,
					`actual_money_t`,`actual_money_e`,
					`actual_delivery_time`,`actual_delivery_time_t`,`actual_delivery_time_e`,
					`get_time_t`,`get_time_e`,`confirmation_time`,
					`payment_time`,`receipt_time`,`close_time`,
					`invoice`,`edit_score`,`special`,`offline`,`payment_type`,`offline_payment_status`,`tm_id`,`match_type`,`term_group_id`,od.description
			FROM `order` o 
			INNER JOIN `dict_industry` di ON o.industry_id = di.industry_id AND o.order_id = '#{order_id}'
			LEFT JOIN `order_description` od ON o.order_id = od.order_id;

		</source>
	</sync-data>
	<sync-data name="updateOrderStatus" >
		<targets>
			<target>
				UPDATE `node_order`
				SET `status` = '${status}'
				WHERE `order_id` = '${order_id}';
			</target>
		</targets>
		<source>
			SELECT `order_id`,`status`
			FROM `order`
			WHERE order_id = #{order_id};
		</source>
	</sync-data>
	<sync-data name="updateNodeOrderStatus" >
		<targets>
			<target>
				UPDATE `order`
				SET `status` = '${status}'
				WHERE `order_id` = '${order_id}';
			</target>
		</targets>
		<source>
			SELECT `order_id`,`status`
			FROM `node_order`
			WHERE order_id = #{order_id};
		</source>
	</sync-data>
	<sync-data name="editorSubmit" >
		<targets>
			<target>
				UPDATE `node_order`
				SET `status` = '${status}',`edit_score` = ${edit_score}
				WHERE `order_id` = '${order_id}';
			</target>
		</targets>
		<source>
			SELECT `order_id`,`status`,`edit_score`
			FROM `order`
			WHERE order_id = #{order_id};
		</source>
	</sync-data>
	<sync-data name="editorNodeSubmit" >
		<targets>
			<target>
				UPDATE `order`
				SET `status` = '${status}',`edit_score` = ${edit_score}
				WHERE `order_id` = '${order_id}';
			</target>
		</targets>
		<source>
			SELECT `order_id`,`status`,`edit_score`
			FROM `node_order`
			WHERE order_id = #{order_id};
		</source>
	</sync-data>
	<sync-data name="insertOrderSearch" >
		<targets>
			<target>
				INSERT INTO `order_search`
				(
					`order_id`,`type`,`status`,
					`delivery_time`,`get_time`,`translator_id`,`node_id`
				)
				VALUES
				(
					'${order_id}','${type}','${status}',
					'${delivery_time}','${get_time}','${translator_id}','${node_id}'
				);
			</target>
			
		</targets>
		<source>
			SELECT `order_id`,`type`,`status`,
			    `delivery_time`,`get_time`,`translator_id`,#{nid} as 'node_id'
			FROM `order_search`
			WHERE order_id = '#{order_id}';
		</source>
	</sync-data>
	<sync-data name="updateOrderSearch" >
		<targets>
			<target>
				UPDATE `order_search`
				SET 
					`status` = '${status}',
					`delivery_time` = '${delivery_time}',
					`get_time` = '${get_time}',
					`translator_id` = '${translator_id}'
				WHERE `order_id` = ${order_id} AND `type` = ${type};
			</target>
			
		</targets>
		<source>
			SELECT `order_id`,`type`,`status`,
			    `delivery_time`,`get_time`,`translator_id`
			FROM `order_search`
			WHERE order_id = '#{order_id}';
		</source>
	</sync-data>
	<sync-data name="insertOrderFile" >
		<targets>
			<target>
				INSERT INTO `node_order_file`
                    (`file_id`,`node_id`,`order_id`,`name`,`source_file_id`,`b_file_id`,
                    `preprocess_file_id`,`trans_file_id`,`edit_file_id`,`tmx_file_id`,
                    `edit_score`,`size`,`word_count`,`analyse_word_count`,
                    `finished_word_count_t`,`finished_word_count_e`,
                    `preview`,`status`,`analyse`)
                VALUES
                    ('${file_id}','${node_id}','${order_id}','${name}','${source_file_id}','${b_file_id}',
                    '${preprocess_file_id}','${trans_file_id}','${edit_file_id}','${tmx_file_id}',
                    '${edit_score}','${size}','${word_count}',${analyse_word_count},
                    '${finished_word_count_t}','${finished_word_count_e}',
                    '${preview}','${status}',${analyse});
			</target>
			
		</targets>
		<source>
			SELECT `file_id`,`order_id`,`name`,`source_file_id`,`b_file_id`,
                `preprocess_file_id`,`trans_file_id`,`edit_file_id`,`tmx_file_id`,
                `edit_score`,`size`,`word_count`,`analyse_word_count`,
                `finished_word_count_t`,`finished_word_count_e`,
                `preview`,`status`,`analyse`,#{nid} as 'node_id'
            FROM `order_file`
            WHERE order_id = '#{order_id}';
		</source>
	</sync-data>
	<sync-data name="updateOrderFile" >
		<targets>
			<target>
				UPDATE`node_order_file`
                SET `name` = '${name}',`source_file_id` = '${source_file_id}',`b_file_id` = '${b_file_id}',
                    `preprocess_file_id` = '${preprocess_file_id}',`trans_file_id` = '${trans_file_id}',`edit_file_id` = '${edit_file_id}',`tmx_file_id` = '${tmx_file_id}',
                    `edit_score` = '${edit_score}',`size` = '${size}',`word_count` = '${word_count}',
                    `finished_word_count_t` = '${finished_word_count_t}',`finished_word_count_e` = '${finished_word_count_e}',
                    `preview` = '${preview}',`status` = '${status}',`analyse` = ${analyse}
                WHERE file_id = '${file_id}';
			</target>			
		</targets>
		<source>
			SELECT `file_id`,`order_id`,`name`,`source_file_id`,`b_file_id`,
                `preprocess_file_id`,`trans_file_id`,`edit_file_id`,`tmx_file_id`,
                `edit_score`,`size`,`word_count`,
                `finished_word_count_t`,`finished_word_count_e`,
                `preview`,`status`,`analyse`,#{nid} as 'node_id'
            FROM `order_file`
            WHERE order_id = '#{order_id}';
		</source>
	</sync-data>
	<sync-data name="insertOrderAttachment" >
		<targets>
			<target>               
				INSERT INTO `node_order_attachment`
					(`node_id`,`order_id`,`name`,`file_id`,`type`)
				VALUES
					('${node_id}','${order_id}','${name}','${file_id}','${type}');
			</target>
			
		</targets>
		<source>
			SELECT `order_attach_id`,`order_id`,`name`,`file_id`,`type`,#{nid} as 'node_id'
			FROM `order_attachment`
			WHERE order_id = '#{order_id}';
		</source>
	</sync-data>
	<sync-data name="setTranslator" >
		<targets>
			<target>
				UPDATE `node_order`
                SET `tnid` = ${tnid},`translator_id` = ${translator_id},`get_time_t` = ${get_time_t}
                WHERE order_id = '${order_id}';
			</target>			
		</targets>
		<source>
			SELECT `order_id`,`tnid`,`translator_id`,`get_time_t`,#{nid} as 'node_id'
            FROM `order`
            WHERE order_id = '#{order_id}';
		</source>
	</sync-data>
	<sync-data name="setEditor" >
		<targets>
			<target>
				UPDATE `node_order`
                SET `enid` = ${enid},`editor_id` = ${editor_id},`get_time_e` = ${get_time_e}
                WHERE order_id = '${order_id}';
			</target>			
		</targets>
		<source>
			SELECT `order_id`,`enid`,`editor_id`,`get_time_e`,#{nid} as 'node_id'
            FROM `order`
            WHERE order_id = '#{order_id}';
		</source>
	</sync-data>
	<sync-data name="updateTranslator" >
	    <targets>
		    <target>
			    UPDATE `node_user`
                SET `level_id` = '${level_id}'
	                ,`experience` = '${experience}'
	                ,`aggregate_money` = '${aggregate_money}'
	                ,`aggregate_money_usd` = '${aggregate_money_usd}'
	                ,`aggregate_money_eur` = '${aggregate_money_eur}'
	                ,`word_count` = '${word_count}'
	                ,`normal_order_number` = '${normal_order_number}'
	                ,`total_order_number` = '${total_order_number}'
                WHERE `user_id` = '${user_id}';
		    </target>
		    <target>
                REPLACE INTO `node_translator_pair_details`(`node_id`,`translator_id`,`pair_id`,`effective_word_count`,`all_word_count`,`create_time`)
                VALUES(${node_id},${user_id},${pair_id}, ${effective_word_count},${pair_word_count},unix_timestamp(now()));
		    </target>
	    </targets>
	    <source>
			SELECT td.level_id,td.experience,td.aggregate_money,td.aggregate_money_usd,td.aggregate_money_eur,td.word_count,td.normal_order_number,td.total_order_number
			    ,tpd.effective_word_count,tpd.all_word_count pair_word_count,#{uid} as 'user_id',#{pair_id} as 'pair_id',#{nid} as 'node_id'
			FROM translator_details td
			INNER JOIN translator_pair_details tpd ON tpd.translator_id = td.translator_id AND td.translator_id = '#{uid}' AND tpd.pair_id = '#{pair_id}';
	    </source>
	</sync-data>
	<sync-data name="setFileStatus" >
		<targets>
			<target>
				UPDATE `node_order_file`
                SET status = ${status}
                WHERE file_id = '${file_id}' AND node_id = ${node_id};                   
			</target>			
		</targets>
		<source>
			SELECT `file_id`,`status`,#{nid} as 'node_id'
            FROM `order_file`
            WHERE order_id = '#{order_id}';
		</source>
	</sync-data>

	
	<sync-data name="insertRoom" >
		<targets>
			<target>
				INSERT INTO `node_room`
                    (`room_id`,`order_id`,`name`,`create_time`,`node_id`)
                VALUES
                    ('${room_id}','${order_id}','${name}','${create_time}','${node_id}');
			</target>			
		</targets>
		<source>
			SELECT `room_id`,`order_id`,`name`,`create_time`,#{nid} as 'node_id'
			FROM `room`
			WHERE `room_id` = #{room_id};
		</source>
	</sync-data>
	
	<sync-data name="insertRoomUser" >
		<targets>
			<target>
				INSERT INTO `node_room_user`
					(`room_user_id`,`room_id`,`user_id`,`connect_time`,`disconnect_time`,`node_id`) 
				VALUES
					('${room_user_id}','${room_id}','${user_id}','${connect_time}','${disconnect_time}','${node_id}')
			</target>			
		</targets>
		<source>
			SELECT `room_user_id`,`room_id`,`user_id`,`connect_time`,`disconnect_time`,#{nid} as 'node_id'
			FROM `room_user`
			WHERE `room_id` = #{room_id};
		</source>
	</sync-data>
	
	<sync-data name="updateConnectTime" >
		<targets>
			<target>
				UPDATE `node_room_user`
				SET
					`connect_time` = '${connect_time}'
				WHERE `user_id` = '${user_id}'
				AND `room_id` = '${room_id}'
				AND `room_user_id` = ${room_user_id}
			</target>			
		</targets>
		<source>
			SELECT `room_user_id`,`room_id`,`user_id`,`connect_time`,`disconnect_time`,#{nid} as 'node_id'
			FROM `room_user`
			WHERE `room_id` = #{room_id} 
			AND `user_id` = #{user_id}
		</source>
	</sync-data>
	
	<sync-data name="updateDisConnectTime" >
		<targets>
			<target>
				UPDATE `node_room_user`
				SET
					`disconnect_time` = '${disconnect_time}'
				WHERE `user_id` = '${user_id}'
				AND `room_id` = '${room_id}'
				AND `room_user_id` = ${room_user_id}
			</target>			
		</targets>
		<source>
			SELECT `room_user_id`,`room_id`,`user_id`,`connect_time`,`disconnect_time`,#{nid} as 'node_id'
			FROM `room_user`
			WHERE `room_id` = #{room_id} 
			AND `user_id` = #{user_id}
		</source>
	</sync-data>
	
	
	<sync-data name="updateNodeConnectTime" >
		<targets>
			<target>
				UPDATE `room_user`
				SET
					`connect_time` = '${connect_time}'
				WHERE `user_id` = '${user_id}'
				AND `room_id` = '${room_id}'
				AND `room_user_id` = ${room_user_id}
			</target>			
		</targets>
		<source>
			SELECT `room_user_id`,`room_id`,`user_id`,`connect_time`,`disconnect_time`,#{nid} as 'node_id'
			FROM `node_room_user`
			WHERE `room_id` = #{room_id} 
			AND `user_id` = #{user_id}
		</source>
	</sync-data>
	
	<sync-data name="updateNodeDisConnectTime" >
		<targets>
			<target>
				UPDATE `room_user`
				SET
					`disconnect_time` = '${disconnect_time}'
				WHERE `user_id` = '${user_id}'
				AND `room_id` = '${room_id}'
				AND `room_user_id` = ${room_user_id}
			</target>			
		</targets>
		<source>
			SELECT `room_user_id`,`room_id`,`user_id`,`connect_time`,`disconnect_time`,#{nid} as 'node_id'
			FROM `node_room_user`
			WHERE `room_id` = #{room_id} 
			AND `user_id` = #{user_id}
		</source>
	</sync-data>

	
	<sync-data name="syncUserMsg">
		<targets>
			<target>
				INSERT INTO `node_message_user`
                (
                    `message_user_id`,`node_id`,`user_id`,`message`,
                    `create_time`,`read`
                )
                VALUES
                (
                    '${message_user_id}','${node_id}','${user_id}','${message}',
                    '${create_time}',${read}
                );

			</target>
			
		</targets>
		<source>
		
			SELECT `message_user_id`,#{nid} as 'node_id',`user_id`,`message`,`create_time`,`read` 
			FROM `message_user` WHERE message_user_id ='#{message_user_id}';
		</source>
	</sync-data>
	
</sync-datas>
