package com.wiitrans.base.misc;

import java.io.ByteArrayInputStream;
import java.io.ByteArrayOutputStream;
import java.util.zip.GZIPInputStream;
import java.util.zip.GZIPOutputStream;

import org.apache.commons.codec.binary.Base64;
import org.apache.commons.lang.StringUtils;

public class ZipUtil {
    public static String compress(String str) throws Exception{
	if(StringUtils.isNotEmpty(str)){
	    ByteArrayOutputStream out = new ByteArrayOutputStream();
	    GZIPOutputStream gzip = new GZIPOutputStream(out);
	    gzip.write(str.getBytes());
	    gzip.finish();
	    gzip.flush();
	    gzip.close();
	    str = new String(new Base64().encode(out.toByteArray()));
	    out.flush();
	    out.close();
	}
	return str;
    }
    
    public static String decompress(String str) throws Exception{
	if(StringUtils.isNotEmpty(str)){
	    
	    ByteArrayOutputStream out = new ByteArrayOutputStream();
	    ByteArrayInputStream in = new ByteArrayInputStream(new Base64().decode(str.getBytes()));
	    GZIPInputStream gzip = new GZIPInputStream(in);
	    byte[] buf = new byte[256];
	    int i;
	    while((i = gzip.read(buf)) >= 0){
		out.write(buf,0,i);
	    }
	    str = out.toString();
	    out.flush();
	    out.close();
	    gzip.close();
	    in.close();
	}
	return str;
    }
    
    public static void main(String[] args) throws Exception {
	String a = "{\"uid\":\"1000000007\",\"sid\":\"lq1c8ja7hrr4jtvmtcbi6bgpb6\",\"param\":{\"uid\":\"1000000007\",\"syncType\":\"rec\",\"nid\":\"2\",\"dataTemplate\":\"insertOrderFile\",\"execSQL\":[\" INSERT INTO `node_order_file`                     (`file_id`,`node_id`,`order_id`,`name`,`source_file_id`,`b_file_id`,                     `preprocess_file_id`,`trans_file_id`,`edit_file_id`,`tmx_file_id`,                     `edit_score`,`size`,`word_count`,`analyse_word_count`,                     `finished_word_count_t`,`finished_word_count_e`,                     `preview`,`status`,`analyse`)                 VALUES                     ('1000000594','2','1000001115','chat.php','M00/02/E8/wKgdzlaxtoaANKAUAAA7aU7vkW0954.php','',                     '','','','',                     '0','0','12',12,                     '0','0',                     '','10',0); \",\" INSERT INTO `node_order_file`                     (`file_id`,`node_id`,`order_id`,`name`,`source_file_id`,`b_file_id`,                     `preprocess_file_id`,`trans_file_id`,`edit_file_id`,`tmx_file_id`,                     `edit_score`,`size`,`word_count`,`analyse_word_count`,                     `finished_word_count_t`,`finished_word_count_e`,                     `preview`,`status`,`analyse`)                 VALUES                     ('1000000595','2','1000001115','api.php','M00/02/E8/wKgdzlaxtoaAAypfAAAQMUHXuJw629.php','',                     '','','','',                     '0','0','13',25,                     '0','0',                     '','10',0); \",\" INSERT INTO `node_order_file`                     (`file_id`,`node_id`,`order_id`,`name`,`source_file_id`,`b_file_id`,                     `preprocess_file_id`,`trans_file_id`,`edit_file_id`,`tmx_file_id`,                     `edit_score`,`size`,`word_count`,`analyse_word_count`,                     `finished_word_count_t`,`finished_word_count_e`,                     `preview`,`status`,`analyse`)                 VALUES                     ('1000000596','2','1000001115','getfile.php','M00/02/E8/wKgdzlaxtoaACSXoAAAFi0ZYQkE405.php','',                     '','','','',                     '0','0','16',41,                     '0','0',                     '','10',0); \",\" INSERT INTO `node_order_file`                     (`file_id`,`node_id`,`order_id`,`name`,`source_file_id`,`b_file_id`,                     `preprocess_file_id`,`trans_file_id`,`edit_file_id`,`tmx_file_id`,                     `edit_score`,`size`,`word_count`,`analyse_word_count`,                     `finished_word_count_t`,`finished_word_count_e`,                     `preview`,`status`,`analyse`)                 VALUES                     ('1000000597','2','1000001115','report.php','M00/02/E9/wKgdzlaxtoeAGMSxAAAFq1jIhNY235.php','',                     '','','','',                     '0','0','18',59,                     '0','0',                     '','10',0); \",\" INSERT INTO `node_order_file`                     (`file_id`,`node_id`,`order_id`,`name`,`source_file_id`,`b_file_id`,                     `preprocess_file_id`,`trans_file_id`,`edit_file_id`,`tmx_file_id`,                     `edit_score`,`size`,`word_count`,`analyse_word_count`,                     `finished_word_count_t`,`finished_word_count_e`,                     `preview`,`status`,`analyse`)                 VALUES                     ('1000000598','2','1000001115','cache.php','M00/02/E8/wKgdzlaxtoaAWsteAAAAVr5rPvk485.php','',                     '','','','',                     '0','0','56',115,                     '0','0',                     '','10',0); \",\" INSERT INTO `node_order_file`                     (`file_id`,`node_id`,`order_id`,`name`,`source_file_id`,`b_file_id`,                     `preprocess_file_id`,`trans_file_id`,`edit_file_id`,`tmx_file_id`,                     `edit_score`,`size`,`word_count`,`analyse_word_count`,                     `finished_word_count_t`,`finished_word_count_e`,                     `preview`,`status`,`analyse`)                 VALUES                     ('1000000599','2','1000001115','intern.php','M00/02/E8/wKgdzlaxtoeABnt7AAAWsUN6uAw259.php','',                     '','','','',                     '0','0','56',171,                     '0','0',                     '','10',0); \",\" INSERT INTO `node_order_file`                     (`file_id`,`node_id`,`order_id`,`name`,`source_file_id`,`b_file_id`,                     `preprocess_file_id`,`trans_file_id`,`edit_file_id`,`tmx_file_id`,                     `edit_score`,`size`,`word_count`,`analyse_word_count`,                     `finished_word_count_t`,`finished_word_count_e`,                     `preview`,`status`,`analyse`)                 VALUES                     ('1000000600','2','1000001115','track.php','M00/02/E9/wKgdzlaxtoeAL9yRAABR-i_Et4k627.php','',                     '','','','',                     '0','0','566',737,                     '0','0',                     '','10',0); \",\" INSERT INTO `node_order_file`                     (`file_id`,`node_id`,`order_id`,`name`,`source_file_id`,`b_file_id`,                     `preprocess_file_id`,`trans_file_id`,`edit_file_id`,`tmx_file_id`,                     `edit_score`,`size`,`word_count`,`analyse_word_count`,                     `finished_word_count_t`,`finished_word_count_e`,                     `preview`,`status`,`analyse`)                 VALUES                     ('1000000601','2','1000001115','language.php','M00/02/E8/wKgdzlaxtoeAA3_XAAALxHcsgtc977.php','',                     '','','','',                     '0','0','56',793,                     '0','0',                     '','10',0); \",\" INSERT INTO `node_order_file`                     (`file_id`,`node_id`,`order_id`,`name`,`source_file_id`,`b_file_id`,                     `preprocess_file_id`,`trans_file_id`,`edit_file_id`,`tmx_file_id`,                     `edit_score`,`size`,`word_count`,`analyse_word_count`,                     `finished_word_count_t`,`finished_word_count_e`,                     `preview`,`status`,`analyse`)                 VALUES                     ('1000000602','2','1000001115','checkout.php','M00/02/E8/wKgdzlaxtoaALnnTAAASNFb3uTg218.php','',                     '','','','',                     '0','0','56',849,                     '0','0',                     '','10',0); \",\" INSERT INTO `node_order_file`                     (`file_id`,`node_id`,`order_id`,`name`,`source_file_id`,`b_file_id`,                     `preprocess_file_id`,`trans_file_id`,`edit_file_id`,`tmx_file_id`,                     `edit_score`,`size`,`word_count`,`analyse_word_count`,                     `finished_word_count_t`,`finished_word_count_e`,                     `preview`,`status`,`analyse`)                 VALUES                     ('1000000603','2','1000001115','visitcard.php','M00/02/E9/wKgdzlaxtoeABTLSAAAMKIKqRe0180.php','',                     '','','','',                     '0','0','56',905,                     '0','0',                     '','10',0); \",\" INSERT INTO `node_order_file`                     (`file_id`,`node_id`,`order_id`,`name`,`source_file_id`,`b_file_id`,                     `preprocess_file_id`,`trans_file_id`,`edit_file_id`,`tmx_file_id`,                     `edit_score`,`size`,`word_count`,`analyse_word_count`,                     `finished_word_count_t`,`finished_word_count_e`,                     `preview`,`status`,`analyse`)                 VALUES                     ('1000000604','2','1000001115','map.php','M00/02/E9/wKgdzlaxtoeAFMBqAAAC-EayfdA271.php','',                     '','','','',                     '0','0','567',1472,                     '0','0',                     '','10',0); \",\" INSERT INTO `node_order_file`                     (`file_id`,`node_id`,`order_id`,`name`,`source_file_id`,`b_file_id`,                     `preprocess_file_id`,`trans_file_id`,`edit_file_id`,`tmx_file_id`,                     `edit_score`,`size`,`word_count`,`analyse_word_count`,                     `finished_word_count_t`,`finished_word_count_e`,                     `preview`,`status`,`analyse`)                 VALUES                     ('1000000605','2','1000001115','extern.php','M00/02/E8/wKgdzlaxtoaAQKpjAAAZdoyBB5U772.php','',                     '','','','',                     '0','0','756',2228,                     '0','0',                     '','10',0); \",\" INSERT INTO `node_order_file`                     (`file_id`,`node_id`,`order_id`,`name`,`source_file_id`,`b_file_id`,                     `preprocess_file_id`,`trans_file_id`,`edit_file_id`,`tmx_file_id`,                     `edit_score`,`size`,`word_count`,`analyse_word_count`,                     `finished_word_count_t`,`finished_word_count_e`,                     `preview`,`status`,`analyse`)                 VALUES                     ('1000000606','2','1000001115','server.php','M00/02/E9/wKgdzlaxtoeAAe5ZAAANoF65Efo684.php','',                     '','','','',                     '0','0','567',2795,                     '0','0',                     '','10',0); \",\" INSERT INTO `node_order_file`                     (`file_id`,`node_id`,`order_id`,`name`,`source_file_id`,`b_file_id`,                     `preprocess_file_id`,`trans_file_id`,`edit_file_id`,`tmx_file_id`,                     `edit_score`,`size`,`word_count`,`analyse_word_count`,                     `finished_word_count_t`,`finished_word_count_e`,                     `preview`,`status`,`analyse`)                 VALUES                     ('1000000607','2','1000001115','index.php','M00/02/E8/wKgdzlaxtoaAJ5zxAAAL26jP-NI080.php','',                     '','','','',                     '0','0','76',2871,                     '0','0',                     '','10',0); \",\" INSERT INTO `node_order_file`                     (`file_id`,`node_id`,`order_id`,`name`,`source_file_id`,`b_file_id`,                     `preprocess_file_id`,`trans_file_id`,`edit_file_id`,`tmx_file_id`,                     `edit_score`,`size`,`word_count`,`analyse_word_count`,                     `finished_word_count_t`,`finished_word_count_e`,                     `preview`,`status`,`analyse`)                 VALUES                     ('1000000608','2','1000001115','email.php','M00/02/E8/wKgdzlaxtoaAeUQzAAAF0mEtP1I826.php','',                     '','','','',                     '0','0','67',2938,                     '0','0',                     '','10',0); \",\" INSERT INTO `node_order_file`                     (`file_id`,`node_id`,`order_id`,`name`,`source_file_id`,`b_file_id`,                     `preprocess_file_id`,`trans_file_id`,`edit_file_id`,`tmx_file_id`,                     `edit_score`,`size`,`word_count`,`analyse_word_count`,                     `finished_word_count_t`,`finished_word_count_e`,                     `preview`,`status`,`analyse`)                 VALUES                     ('1000000609','2','1000001115','livezilla.php','M00/02/E9/wKgdzlaxtoeAUYwOAAABmXNPSmE784.php','',                     '','','','',                     '0','0','67',3005,                     '0','0',                     '','10',0); \",\" INSERT INTO `node_order_file`                     (`file_id`,`node_id`,`order_id`,`name`,`source_file_id`,`b_file_id`,                     `preprocess_file_id`,`trans_file_id`,`edit_file_id`,`tmx_file_id`,                     `edit_score`,`size`,`word_count`,`analyse_word_count`,                     `finished_word_count_t`,`finished_word_count_e`,                     `preview`,`status`,`analyse`)                 VALUES                     ('1000000610','2','1000001115','validate.php','M00/02/E9/wKgdzlaxtoeAX2oBAAAI25Zo5Wo433.php','',                     '','','','',                     '0','0','76',3081,                     '0','0',                     '','10',0); \",\" INSERT INTO `node_order_file`                     (`file_id`,`node_id`,`order_id`,`name`,`source_file_id`,`b_file_id`,                     `preprocess_file_id`,`trans_file_id`,`edit_file_id`,`tmx_file_id`,                     `edit_score`,`size`,`word_count`,`analyse_word_count`,                     `finished_word_count_t`,`finished_word_count_e`,                     `preview`,`status`,`analyse`)                 VALUES                     ('1000000611','2','1000001115','ressource.php','M00/02/E9/wKgdzlaxtoeAeVXnAAAGLp5OrgI428.php','',                     '','','','',                     '0','0','1110',4191,                     '0','0',                     '','10',0); \",\" INSERT INTO `node_order_file`                     (`file_id`,`node_id`,`order_id`,`name`,`source_file_id`,`b_file_id`,                     `preprocess_file_id`,`trans_file_id`,`edit_file_id`,`tmx_file_id`,                     `edit_score`,`size`,`word_count`,`analyse_word_count`,                     `finished_word_count_t`,`finished_word_count_e`,                     `preview`,`status`,`analyse`)                 VALUES                     ('1000000612','2','1000001115','ovl.php','M00/02/E9/wKgdzlaxtoeAXoFWAACnchATd48615.php','',                     '','','','',                     '0','0','75',4266,                     '0','0',                     '','10',0); \",\" INSERT INTO `node_order_file`                     (`file_id`,`node_id`,`order_id`,`name`,`source_file_id`,`b_file_id`,                     `preprocess_file_id`,`trans_file_id`,`edit_file_id`,`tmx_file_id`,                     `edit_score`,`size`,`word_count`,`analyse_word_count`,                     `finished_word_count_t`,`finished_word_count_e`,                     `preview`,`status`,`analyse`)                 VALUES                     ('1000000613','2','1000001115','image.php','M00/02/E8/wKgdzlaxtoaAJZw5AAAUv0zq3x0834.php','',                     '','','','',                     '0','0','76',4342,                     '0','0',                     '','10',0); \",\" INSERT INTO `node_order_file`                     (`file_id`,`node_id`,`order_id`,`name`,`source_file_id`,`b_file_id`,                     `preprocess_file_id`,`trans_file_id`,`edit_file_id`,`tmx_file_id`,                     `edit_score`,`size`,`word_count`,`analyse_word_count`,                     `finished_word_count_t`,`finished_word_count_e`,                     `preview`,`status`,`analyse`)                 VALUES                     ('1000000614','2','1000001115','picture.php','M00/02/E9/wKgdzlaxtoeAYgF3AAAFRx4cxwA348.php','',                     '','','','',                     '0','0','5',4347,                     '0','0',                     '','10',0); \"],\"className\":\"com.wiitrans.automation.logic.SyncDataLogicImpl\",\"order_id\":\"1000001115\"},\"nid\":\"2\",\"taskType\":\"1\",\"task_id\":\"21670\",\"aid\":\"newtask\",\"corn\":\"\",\"job_class\":\"com.wiitrans.automation.quartz.job.PushStromJob\",\"method\":\"POST\",\"tzid\":\"-18\",\"bid\":\"automation\"}";
	System.out.println("current length:"+a.length());
	String b = ZipUtil.compress(a);
	System.out.println("compressed length:"+a.length());
	String c = ZipUtil.decompress(b);
	System.out.println("uncompressed length:"+c.length());
	System.out.println("c:"+c);
	System.out.println("equals"+a.equals(c));
    }
}
