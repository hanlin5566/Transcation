<?xml version="1.0" encoding="UTF-8" ?>  
<!DOCTYPE mapper PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN" "http://mybatis.org/dtd/mybatis-3-mapper.dtd">
<mapper namespace="com.wiitrans.base.db.model.TMBeanMapper">

	<select id="SelectAll" resultType="com.wiitrans.base.db.model.TMBean">
		SELECT `tm_id`,
		`industry_id`,
		`pair_id`,
		`name`,
		`create_time`
		FROM `tm`;
	</select>

	<select id="SelectForTMID" resultType="com.wiitrans.base.db.model.TMBean">
		SELECT
		t.tm_id,t.custo_id,t.industry_id,t.pair_id,lc.lang_country,
		t.name,t.tmx_file_id,t.create_time,t.analyse
		FROM tm t
		INNER JOIN
		dict_language_pair lp ON t.pair_id = lp.pair_id
		INNER JOIN
		dict_language_country lc ON lp.source_lang = lc.lang_id AND
		t.lang_country_id = lc.lang_country_id
		WHERE tm_id = #{tm_id};
	</select>
	<select id="SelectForNodeTMID" resultType="com.wiitrans.base.db.model.TMBean">
		SELECT
		t.tm_id,t.custo_id,t.industry_id,t.pair_id,lc.lang_country,
		t.name,t.tmx_file_id,t.create_time,t.analyse
		FROM node_tm t
		INNER JOIN
		dict_language_pair lp ON t.pair_id = lp.pair_id
		INNER JOIN
		dict_language_country lc ON lp.source_lang = lc.lang_id AND
		t.lang_country_id = lc.lang_country_id
		WHERE tm_id = #{tm_id};
	</select>

	<update id="UpdateAnalyse" parameterType="com.wiitrans.base.db.model.TMBean">
		UPDATE `tm`
		SET analyse
		= #{analyse}
		WHERE tm_id = #{tm_id}
	</update>
	<update id="UpdateAnalyseForNode" parameterType="com.wiitrans.base.db.model.TMBean">
		UPDATE `node_tm`
		SET analyse = #{analyse}
		WHERE tm_id = #{tm_id}
	</update>
	<update id="Delete" parameterType="int">
		DELETE FROM `tm`	WHERE tm_id = #{0}
	</update>
	<update id="DeleteForNode" parameterType="int">
		DELETE FROM `node_tm` WHERE tm_id = #{0}
	</update>
	<select id="Deletable" parameterType="Map" resultType="Integer">
		SELECT tm_id
		FROM tm t
		WHERE NOT EXISTS(
			SELECT tm_id 
			FROM `order`
			WHERE status = 20 AND tm_id = t.tm_id
		)
		AND NOT EXISTS(
			SELECT tm_id 
			FROM `node_order` 
			WHERE status = 20 AND tm_id = t.tm_id
		)
		AND tm_id IN 
		<foreach item="item" index="index" collection="tmIDs" open="("
			separator="," close=")">
			#{item}
		</foreach>
	</select>

</mapper>