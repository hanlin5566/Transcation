<?xml version="1.0" encoding="UTF-8" ?>  
<!DOCTYPE mapper PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN" "http://mybatis.org/dtd/mybatis-3-mapper.dtd">
<mapper namespace="com.wiitrans.base.db.model.VoteBeanMapper">
	<insert id="addVote" parameterType="com.wiitrans.base.db.model.VoteBean" useGeneratedKeys="true" keyProperty="mapping_id" >
		INSERT INTO
		ques_strategy_mapping(test_ques_id,`type`,strategy_id,judge) VALUES(#{test_ques_id},#{type},#{strategy_id},#{judge})
	</insert>
	
	<select id="getUnKnowJudgeVoteCount" parameterType="int" resultType="int">
		SELECT count(strategy_id) as voteCount FROM ques_strategy_mapping WHERE `type` = 2 GROUP BY strategy_id HAVING strategy_id = #{strategy_id}
	</select>
	
	<select id="getJudgeVoteCount" parameterType="int" resultType="Map">
		SELECT SUM(CASE WHEN judge = 1 then 1 else 0 end) as 'right' ,SUM(CASE WHEN judge = 2 then 1 else 0 end) as 'wrong'  
		FROM ques_strategy_mapping WHERE `type` = 2 AND  strategy_id = #{strategy_id}
	</select>
	
	<delete id="deleteVote" parameterType="int">
		DELETE FROM ques_strategy_mapping WHERE strategy_id = #{strategy_id}
	</delete>
</mapper>