<?xml version="1.0" encoding="UTF-8" ?>  
<!DOCTYPE mapper PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN" "http://mybatis.org/dtd/mybatis-3-mapper.dtd">
<mapper namespace="com.wiitrans.base.db.model.RecomOrderBeanMapper">

	<select id="Select" resultType="com.wiitrans.base.db.model.RecomOrderBean">

		SELECT o.order_id,o.translator_id,o.editor_id,o.customer_id,l.price_level_id,l.level,o.code,a.language_name sname,
			b.language_name tname,i.industry_name industry,i.cname industry_cname,i.ename industry_ename,
			o.industry_id,o.pair_id,o.word_count,o.analyse_word_count,o.currency_id,o.expected_delivery_time	delivery_time,
			o.expected_delivery_time_t delivery_time_t,o.expected_delivery_time_e delivery_time_e,
			o.need_time,o.expected_money_t money_t,o.expected_money_e money_e,o.preprocess,IFNULL(d.description,'') description
			,match_type,change_type,custo_rate
		FROM `order` o
		INNER JOIN `dict_language_pair` p ON o.pair_id = p.pair_id AND o.code =	#{code} AND o.status = 20
			AND (o.translator_id = 0 OR o.editor_id = 0 AND o.price_level_id > 1)
		INNER JOIN `dict_language` a ON p.source_lang = a.language_id
		INNER JOIN `dict_language` b ON	p.target_lang = b.language_id
		INNER JOIN `dict_industry` i ON	o.industry_id = i.industry_id
		INNER JOIN `dict_price_level` l ON o.price_level_id = l.price_level_id
		LEFT OUTER JOIN `order_description` d ON o.order_id = d.order_id
		LIMIT 1;
	</select>
	<select id="SelectRecomT" resultType="String">
		SELECT GROUP_CONCAT(translator_id) recom
		FROM order_recom 
		WHERE order_id = #{0}
		AND type = 1
	</select>
	<select id="SelectRecomE" resultType="String">
		SELECT GROUP_CONCAT(translator_id) recom
		FROM order_recom 
		WHERE order_id = #{0}
		AND type = 2
	</select>
	<select id="SelectTeam" resultType="String">
		SELECT GROUP_CONCAT(translator_id) team
		FROM team_custo_details
		WHERE team_id IN (
			SELECT team_id 
			FROM team_custo 
			WHERE customer_id = #{0} 
			AND pair_id = #{1} 
			AND closed = 0 
		);
	</select>
</mapper>